services:
  grafana:
    image: grafana/grafana
    container_name: grafana
    ports:
      - "3000:3000"
    networks:
      cluster:
        ipv4_address: 192.168.0.5
    volumes:
      - ./grafana-datasource-config.yaml:/etc/grafana/provisioning/datasources/datasource.yaml

  prometheus:
    image: prom/prometheus
    container_name: prometheus
    networks:
      cluster:
        ipv4_address: 192.168.0.7
    volumes:
      - ./prometheus/:/etc/prometheus/
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    ports:
      - 9090:9090

  mysql-exporter:
    image: prom/mysqld-exporter
    container_name: mysql-exporter
    hostname: mysql-exporter
    command:
     - --config.my-cnf=/cfg/.my.cnf
     - --mysqld.address=192.168.0.10:3306
    volumes:
      - ./config.my-cnf:/cfg/.my.cnf
    ports:
      - 9104:9104
    networks:
      cluster:
        ipv4_address: 192.168.0.13

  cadvisor:
      image: gcr.io/cadvisor/cadvisor:latest
      container_name: cadvisor
      hostname: cadvisor
      platform: linux/aarch64
      volumes:
        - "/:/rootfs:ro"
        - "/var/run:/var/run:ro"
        - "/sys:/sys:ro"
        - "/var/lib/docker/:/var/lib/docker:ro"
        - "/dev/disk/:/dev/disk:ro"
      ports:
        - "8080:8080"
      networks:
        cluster:
          ipv4_address: 192.168.0.6

  management1:
    image: mysql/mysql-cluster
    container_name: management1
    command: ndb_mgmd
    networks:
      cluster:
        ipv4_address: 192.168.0.2

  ndb1:
    image: mysql/mysql-cluster
    container_name: ndb1
    command: ndbd
    networks:
      cluster:
        ipv4_address: 192.168.0.3

  ndb2:
    image: mysql/mysql-cluster
    container_name: ndb2
    command: ndbd
    networks:
      cluster:
        ipv4_address: 192.168.0.4

  mysql1:
    image: mysql/mysql-cluster
    container_name: mysql1
      #entrypoint:
      #- "mysql -u root -pnicolas db < /sql_script.sql"
    command: mysqld
    environment:
      MYSQL_ROOT_PASSWORD: nicolas
      MYSQL_DATABASE: db
    networks:
      cluster:
        ipv4_address: 192.168.0.10
    volumes:
      - ./sql_script.sql:/docker-entrypoint-initdb.d/sql_script.sql
      - ./privileges.sql:/docker-entrypoint-initdb.d/privileges.sql


networks:
  cluster:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.0.0/24
